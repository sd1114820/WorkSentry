<!doctype html>
<html lang='zh-CN'>
<head>
  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>WorkSentry 管理端</title>
  <link rel='stylesheet' href='/assets/app.css' />
</head>
<body>
  <div class='auth-modal' id='authModal'>
    <div class='auth-card'>
      <h2>管理员登录</h2>
      <p class='muted'>请输入账号密码进入管理后台</p>
      <div class='form-grid'>
        <label class='full'>
          <span>账号</span>
          <input type='text' id='loginUsername' placeholder='请输入账号' />
        </label>
        <label class='full'>
          <span>密码</span>
          <input type='password' id='loginPassword' placeholder='请输入密码' />
        </label>
      </div>
      <div class='form-actions'>
        <button class='btn btn-primary' id='loginBtn'>登录</button>
        <span class='form-status' id='loginStatus'></span>
      </div>
    </div>
  </div>

  <div class='app-shell'>
    <aside class='sidebar'>
      <div class='brand'>
        <div class='brand-icon' aria-hidden='true'>
          <svg viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'>
            <path d='M3 12h18' />
            <path d='M12 3v18' />
            <circle cx='12' cy='12' r='9' />
          </svg>
        </div>
        <div>
          <div class='brand-title'>WorkSentry</div>
          <div class='brand-sub'>办公效能审计系统</div>
        </div>
      </div>
      <nav class='nav'>
        <button class='nav-item is-active' data-target='live'>实时监控</button>
        <button class='nav-item' data-target='rules'>规则配置</button>
        <button class='nav-item' data-target='reports'>数据报表</button>
        <button class='nav-item' data-target='audit'>异常与审计</button>
        <button class='nav-item' data-target='org'>组织与员工</button>
      </nav>
      <div class='sidebar-footer'>
        <div class='status-pill'>连接状态：<span id='connectionStatus'>待连接</span></div>
      </div>
    </aside>

    <main class='main'>
      <header class='topbar'>
        <div>
          <h1>管理控制台</h1>
          <p class='muted'>实时监控、规则配置、报表与审计统一入口</p>
        </div>
        <div class='topbar-meta'>
          <div class='meta-card'>
            <div class='meta-label'>公司时区</div>
            <div class='meta-value' id='timezoneValue'>Asia/Shanghai</div>
          </div>
          <div class='meta-card'>
            <div class='meta-label'>更新策略</div>
            <div class='meta-value' id='updatePolicyValue'>提示更新</div>
          </div>
          <div class='meta-card'>
            <div class='meta-label'>当前账号</div>
            <div class='meta-value' id='adminName'>未登录</div>
          </div>
          <button class='btn btn-secondary' id='logoutBtn'>退出登录</button>
        </div>
      </header>

      <section class='section is-active' id='section-live'>
        <div class='section-header'>
          <div>
            <h2>实时监控大屏</h2>
            <p class='muted'>显示上一次状态与延迟倒计时，超时自动离线</p>
          </div>
          <div class='section-actions'>
            <input class='search-input' type='search' id='liveSearch' placeholder='搜索姓名 / 工号 / 部门' />
            <button class='btn btn-secondary' id='refreshLive'>刷新</button>
          </div>
        </div>
        <div class='card'>
          <div class='live-legend'>
            <span class='legend-item'><span class='dot work'></span>工作</span>
            <span class='legend-item'><span class='dot normal'></span>常规</span>
            <span class='legend-item'><span class='dot fish'></span>摸鱼</span>
            <span class='legend-item'><span class='dot idle'></span>离开</span>
            <span class='legend-item'><span class='dot offline'></span>离线</span>
          </div>
          <div class='live-group-list' id='liveGrid'></div>
          <div class='empty-hint' id='liveEmpty'>暂无在线数据</div>
        </div>
      </section>

      <section class='section' id='section-rules'>
        <div class='section-header'>
          <div>
            <h2>规则配置中心</h2>
            <p class='muted'>黑优先、即时生效。避免展示数据库原始值。</p>
          </div>
          <div class='section-actions'>
            <button class='btn btn-secondary' id='refreshRules'>刷新规则</button>
          </div>
        </div>

        <div class='grid-2'>
          <div class='card'>
            <h3>全局阈值与更新策略</h3>
            <div class='form-grid'>
              <label>
                <span>闲置阈值（秒）</span>
                <input type='number' id='idleThreshold' min='60' step='10' />
              </label>
              <label>
                <span>心跳间隔（秒）</span>
                <input type='number' id='heartbeatInterval' min='60' step='10' />
              </label>
              <label>
                <span>离线阈值（秒）</span>
                <input type='number' id='offlineThreshold' min='120' step='10' />
              </label>
              <label>
                <span>摸鱼比例阈值（%）</span>
                <input type='number' id='fishRatioWarn' min='0' max='100' step='1' />
              </label>
              <label>
                <span>更新策略</span>
                <select id='updatePolicy'>
                  <option value='0'>提示更新</option>
                  <option value='1'>强制更新</option>
                </select>
              </label>
              <label class='full'>
                <span>最新版本号</span>
                <input type='text' id='latestVersion' placeholder='例如 1.0.8' />
              </label>
              <label class='full'>
                <span>更新下载地址</span>
                <input type='text' id='updateUrl' placeholder='https://...' />
              </label>
            </div>
            <div class='config-warning is-hidden' id='settingsWarning' role='alert'>
              <div class='config-warning-title'>配置提示</div>
              <ul id='settingsWarningList'></ul>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveSettings'>保存配置</button>
              <span class='form-status' id='settingsStatus'></span>
            </div>
          </div>

          <div class='card'>
            <h3>新增规则</h3>
            <div class='form-grid'>
              <label>
                <span>规则类型</span>
                <select id='ruleType'>
                  <option value='white'>白名单</option>
                  <option value='black'>黑名单</option>
                </select>
              </label>
              <label>
                <span>匹配方式</span>
                <select id='matchMode'>
                  <option value='process'>进程名</option>
                  <option value='title'>标题关键词</option>
                </select>
              </label>
              <label class='full'>
                <span>匹配值（可用逗号或换行批量录入）</span>
                <textarea id='matchValue' placeholder='例如 telegram.exe / SaleSmartly'></textarea>
              </label>
              <label class='full'>
                <span>备注</span>
                <input type='text' id='ruleRemark' placeholder='选填' />
              </label>
              <label class='inline'>
                <input type='checkbox' id='ruleEnabled' checked />
                <span>启用规则</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createRule'>保存规则</button>
              <button class='btn btn-secondary' id='cancelRule'>取消编辑</button>
              <span class='form-status' id='ruleStatus'></span>
            </div>
          </div>
        </div>

        <div class='card'>
          <h3>规则清单</h3>
          <div class='table' id='rulesTable'></div>
        </div>
      </section>

      <section class='section' id='section-reports'>
        <div class='section-header'>
          <div>
            <h2>数据报表</h2>
            <p class='muted'>按自然日统计：工作 / 常规 / 摸鱼 / 离开 / 离线</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>日统计汇总</h3>
            <div class='form-grid'>
              <label>
                <span>日期</span>
                <input type='date' id='reportDate' />
              </label>
              <label>
                <span>部门筛选</span>
                <select id='reportDepartment'></select>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-secondary' id='loadDailyReport'>加载报表</button>
              <button class='btn btn-secondary' id='exportDaily'>导出 Excel</button>
            </div>
            <div class='table' id='dailyReportTable'></div>
          </div>
          <div class='card'>
            <h3>个人时间轴</h3>
            <div class='form-grid'>
              <label>
                <span>员工</span>
                <select id='timelineEmployee'></select>
              </label>
              <label>
                <span>日期</span>
                <input type='date' id='timelineDate' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-secondary' id='loadTimeline'>加载时间轴</button>
            </div>
            <div class='table' id='timelineTable'></div>
          </div>
        </div>
        <div class='card'>
          <h3>团队排行</h3>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadRank'>刷新排行</button>
          </div>
          <div class='grid-2'>
            <div>
              <div class='table' id='rankWorkTable'></div>
            </div>
            <div>
              <div class='table' id='rankFishTable'></div>
            </div>
          </div>
        </div>
      </section>

      <section class='section' id='section-audit'>
        <div class='section-header'>
          <div>
            <h2>异常与审计</h2>
            <p class='muted'>离线补录、系统事故、操作审计</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>离线补录</h3>
            <div class='form-grid'>
              <label>
                <span>员工</span>
                <select id='adjustEmployee'></select>
              </label>
              <label>
                <span>开始时间</span>
                <input type='datetime-local' id='adjustStart' />
              </label>
              <label>
                <span>结束时间</span>
                <input type='datetime-local' id='adjustEnd' />
              </label>
              <label>
                <span>原因</span>
                <select id='adjustReason'>
                  <option value='停电'>停电</option>
                  <option value='断网'>断网</option>
                  <option value='外勤'>外勤</option>
                  <option value='系统故障'>系统故障</option>
                </select>
              </label>
              <label class='full'>
                <span>备注（必填）</span>
                <input type='text' id='adjustNote' placeholder='请填写具体原因' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createAdjustment'>提交补录</button>
              <button class='btn btn-secondary' id='cancelAdjustment'>取消编辑</button>
              <span class='form-status' id='adjustStatus'></span>
            </div>
            <div class='table' id='adjustmentsTable'></div>
          </div>
          <div class='card'>
            <h3>系统事故登记</h3>
            <div class='form-grid'>
              <label>
                <span>开始时间</span>
                <input type='datetime-local' id='incidentStart' />
              </label>
              <label>
                <span>结束时间</span>
                <input type='datetime-local' id='incidentEnd' />
              </label>
              <label class='full'>
                <span>原因</span>
                <input type='text' id='incidentReason' placeholder='例如 数据库维护' />
              </label>
              <label class='full'>
                <span>备注</span>
                <input type='text' id='incidentNote' placeholder='可选' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createIncident'>登记事故</button>
              <button class='btn btn-secondary' id='cancelIncident'>取消编辑</button>
              <span class='form-status' id='incidentStatus'></span>
            </div>
            <div class='table' id='incidentsTable'></div>
          </div>
        </div>
        <div class='card'>
          <h3>离线段列表</h3>
          <div class='form-grid'>
            <label>
              <span>日期</span>
              <input type='date' id='offlineDate' />
            </label>
            <label>
              <span>员工筛选</span>
              <select id='offlineEmployee'></select>
            </label>
          </div>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadOfflineSegments'>刷新列表</button>
          </div>
          <div class='table' id='offlineSegmentsTable'></div>
        </div>
        <div class='card'>
          <h3>操作审计</h3>
          <div class='form-grid'>
            <label>
              <span>日期</span>
              <input type='date' id='auditDate' />
            </label>
          </div>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadAudit'>加载审计</button>
          </div>
          <div class='table' id='auditTable'></div>
        </div>
      </section>

      <section class='section' id='section-org'>
        <div class='section-header'>
          <div>
            <h2>组织与员工</h2>
            <p class='muted'>部门与员工档案维护，避免手工输入</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>部门管理</h3>
            <div class='form-grid'>
              <label class='full'>
                <span>部门名称</span>
                <input type='text' id='deptName' placeholder='请输入部门名称' />
              </label>
              <label class='full'>
                <span>上级部门</span>
                <select id='deptParent'></select>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveDepartment'>保存部门</button>
              <button class='btn btn-secondary' id='cancelDepartment'>取消编辑</button>
              <span class='form-status' id='deptStatus'></span>
            </div>
            <div class='table' id='departmentsTable'></div>
          </div>
          <div class='card'>
            <h3>员工管理</h3>
            <div class='form-grid'>
              <label>
                <span>工号</span>
                <input type='text' id='employeeCode' placeholder='留空自动生成，例如 A0001' />
              </label>
              <label>
                <span>姓名</span>
                <input type='text' id='employeeName' placeholder='请输入姓名' />
              </label>
              <label>
                <span>部门</span>
                <select id='employeeDepartment'></select>
              </label>
              <label class='inline'>
                <input type='checkbox' id='employeeEnabled' checked />
                <span>启用员工</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveEmployee'>保存员工</button>
              <button class='btn btn-secondary' id='cancelEmployee'>取消编辑</button>
              <span class='form-status' id='employeeStatus'></span>
            </div>
            <div class='table' id='employeesTable'></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src='/assets/app.js'></script>
</body>
</html>

