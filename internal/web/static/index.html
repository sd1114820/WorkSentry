<!doctype html>
<html lang='zh-CN'>
<head>
  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>WorkSentry 管理端</title>
  <link rel='stylesheet' href='/assets/app.css' />
</head>
<body>
  <div class='auth-modal' id='authModal'>
    <div class='auth-card'>
      <h2>管理员登录</h2>
      <p class='muted'>请输入账号密码进入管理后台</p>
      <div class='form-grid'>
        <label class='full'>
          <span>账号</span>
          <input type='text' id='loginUsername' placeholder='请输入账号' />
        </label>
        <label class='full'>
          <span>密码</span>
          <input type='password' id='loginPassword' placeholder='请输入密码' />
        </label>
      </div>
      <div class='form-actions'>
        <button class='btn btn-primary' id='loginBtn'>登录</button>
        <span class='form-status' id='loginStatus'></span>
      </div>
    </div>
  </div>

  <div class='app-shell'>
    <aside class='sidebar'>
      <div class='brand'>
        <div class='brand-icon' aria-hidden='true'>
          <svg viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'>
            <path d='M3 12h18' />
            <path d='M12 3v18' />
            <circle cx='12' cy='12' r='9' />
          </svg>
        </div>
        <div>
          <div class='brand-title'>WorkSentry</div>
          <div class='brand-sub'>办公效能审计系统</div>
        </div>
      </div>
      <nav class='nav'>
        <button class='nav-item is-active' data-target='live'>实时监控</button>
        <button class='nav-item' data-target='rules'>规则配置</button>
        <button class='nav-item' data-target='reports'>数据报表</button>
        <button class='nav-item' data-target='attendance'>工时考核</button>
        <button class='nav-item' data-target='audit'>异常与审计</button>
        <button class='nav-item' data-target='org'>组织与员工</button>
        <button class='nav-item' data-target='checkout'>下班录入</button>
      </nav>
      <div class='sidebar-footer'>
        <div class='status-pill'>连接状态：<span id='connectionStatus'>待连接</span></div>
      </div>
    </aside>

    <main class='main'>
      <header class='topbar'>
        <div>
          <h1>管理控制台</h1>
          <p class='muted'>实时监控、规则配置、报表与审计统一入口</p>
        </div>
        <div class='topbar-meta'>
          <div class='meta-card'>
            <div class='meta-label'>公司时区</div>
            <div class='meta-value' id='timezoneValue'>Asia/Shanghai</div>
          </div>
          <div class='meta-card'>
            <div class='meta-label'>更新策略</div>
            <div class='meta-value' id='updatePolicyValue'>提示更新</div>
          </div>
          <div class='meta-card'>
            <div class='meta-label'>当前账号</div>
            <div class='meta-value' id='adminName'>未登录</div>
          </div>
          <button class='btn btn-secondary' id='logoutBtn'>退出登录</button>
        </div>
      </header>

      <section class='section is-active' id='section-live'>
        <div class='section-header'>
          <div>
            <h2>实时监控大屏</h2>
            <p class='muted'>显示上一次状态与延迟倒计时，超时自动离线</p>
          </div>
          <div class='section-actions'>
            <input class='search-input' type='search' id='liveSearch' placeholder='搜索姓名 / 工号 / 部门' />
            <button class='btn btn-secondary' id='refreshLive'>刷新</button>
          </div>
        </div>
        <div class='card'>
          <div class='live-legend'>
            <span class='legend-item'><span class='dot work'></span>工作</span>
            <span class='legend-item'><span class='dot normal'></span>常规</span>
            <span class='legend-item'><span class='dot fish'></span>摸鱼</span>
            <span class='legend-item'><span class='dot idle'></span>离开</span>
            <span class='legend-item'><span class='dot offline'></span>离线</span>
          </div>
          <div class='live-group-list' id='liveGrid'></div>
          <div class='empty-hint' id='liveEmpty'>暂无在线数据</div>
        </div>
      </section>

      <section class='section' id='section-rules'>
        <div class='section-header'>
          <div>
            <h2>规则配置中心</h2>
            <p class='muted'>黑优先、即时生效。避免展示数据库原始值。</p>
          </div>
          <div class='section-actions'>
            <button class='btn btn-secondary' id='refreshRules'>刷新规则</button>
          </div>
        </div>

        <div class='grid-2'>
          <div class='card'>
            <h3>全局阈值与更新策略</h3>
            <div class='form-grid'>
              <label>
                <span>闲置阈值（秒）</span>
                <input type='number' id='idleThreshold' min='60' step='10' />
              </label>
              <label>
                <span>心跳间隔（秒）</span>
                <input type='number' id='heartbeatInterval' min='60' step='10' />
              </label>
              <label>
                <span>离线阈值（秒）</span>
                <input type='number' id='offlineThreshold' min='120' step='10' />
              </label>
              <label>
                <span>摸鱼比例阈值（%）</span>
                <input type='number' id='fishRatioWarn' min='0' max='100' step='1' />
              </label>
              <label>
                <span>更新策略</span>
                <select id='updatePolicy'>
                  <option value='0'>提示更新</option>
                  <option value='1'>强制更新</option>
                </select>
              </label>
              <label class='full'>
                <span>最新版本号</span>
                <input type='text' id='latestVersion' placeholder='例如 1.0.8' />
              </label>
              <label class='full'>
                <span>更新下载地址</span>
                <input type='text' id='updateUrl' placeholder='https://...' />
              </label>
            </div>
            <div class='config-warning is-hidden' id='settingsWarning' role='alert'>
              <div class='config-warning-title'>配置提示</div>
              <ul id='settingsWarningList'></ul>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveSettings'>保存配置</button>
              <span class='form-status' id='settingsStatus'></span>
            </div>
          </div>

          <div class='card'>
            <h3>新增规则</h3>
            <div class='form-grid'>
              <label>
                <span>规则类型</span>
                <select id='ruleType'>
                  <option value='white'>白名单</option>
                  <option value='black'>黑名单</option>
                </select>
              </label>
              <label>
                <span>匹配方式</span>
                <select id='matchMode'>
                  <option value='process'>进程名</option>
                  <option value='title'>标题关键词</option>
                </select>
              </label>
              <label class='full'>
                <span>匹配值（可用逗号或换行批量录入）</span>
                <textarea id='matchValue' placeholder='例如 telegram.exe / SaleSmartly'></textarea>
              </label>
              <label class='full'>
                <span>备注</span>
                <input type='text' id='ruleRemark' placeholder='选填' />
              </label>
              <label class='inline'>
                <input type='checkbox' id='ruleEnabled' checked />
                <span>启用规则</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createRule'>保存规则</button>
              <button class='btn btn-secondary' id='cancelRule'>取消编辑</button>
              <span class='form-status' id='ruleStatus'></span>
            </div>
          </div>
        </div>

        <div class='card'>
          <h3>规则清单</h3>
          <div class='table' id='rulesTable'></div>
        </div>
      </section>

      <section class='section' id='section-reports'>
        <div class='section-header'>
          <div>
            <h2>数据报表</h2>
            <p class='muted'>按自然日统计：工作 / 常规 / 摸鱼 / 离开 / 离线</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>日统计汇总</h3>
            <div class='form-grid'>
              <label>
                <span>日期</span>
                <input type='date' id='reportDate' />
              </label>
              <label>
                <span>部门筛选</span>
                <select id='reportDepartment'></select>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-secondary' id='loadDailyReport'>加载报表</button>
              <button class='btn btn-secondary' id='exportDaily'>导出 Excel</button>
            </div>
            <div class='table' id='dailyReportTable'></div>
          </div>
          <div class='card'>
            <h3>个人时间轴</h3>
            <div class='form-grid'>
              <label>
                <span>员工</span>
                <div class="search-select" id="timelineEmployeeSelect">
  <input type="text" id="timelineEmployeeSearch" placeholder="搜索工号 / 姓名" autocomplete="off" />
  <input type="hidden" id="timelineEmployee" />
  <div class="search-select-panel" id="timelineEmployeePanel"></div>
</div>
<div class="field-hint" id="timelineEmployeeHint">正在加载员工...</div>
              </label>
              <label>
                <span>日期</span>
                <input type='date' id='timelineDate' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-secondary' id='loadTimeline'>加载时间轴</button>
            </div>
            <div class='table' id='timelineTable'></div>
          </div>
        </div>
        <div class='card'>
          <h3>团队排行</h3>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadRank'>刷新排行</button>
          </div>
          <div class='grid-2'>
            <div>
              <div class='table' id='rankWorkTable'></div>
            </div>
            <div>
              <div class='table' id='rankFishTable'></div>
            </div>
          </div>
        </div>
      </section>

            <section class='section' id='section-attendance'>
        <div class='section-header'>
          <div>
            <h2>工时与休息考核</h2>
            <p class='muted'>按部门配置工时标准、休息规则与状态阈值</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>部门规则配置</h3>
            <div class='form-grid'>
              <label class='full'>
                <span>部门</span>
                <select id='attendanceDepartment'></select>
              </label>
              <label>
                <span>目标工时（小时）</span>
                <input type='number' id='attendanceTargetHours' min='0' />
              </label>
              <label>
                <span>目标工时（分钟）</span>
                <input type='number' id='attendanceTargetMinutes' min='0' max='59' />
              </label>
              <label>
                <span>休息总时长（小时）</span>
                <input type='number' id='attendanceBreakHours' min='0' />
              </label>
              <label>
                <span>休息总时长（分钟）</span>
                <input type='number' id='attendanceBreakMinutes' min='0' max='59' />
              </label>
              <label>
                <span>休息次数上限</span>
                <input type='number' id='attendanceBreakCount' min='0' />
              </label>
              <label>
                <span>单次休息上限（小时）</span>
                <input type='number' id='attendanceBreakSingleHours' min='0' />
              </label>
              <label>
                <span>单次休息上限（分钟）</span>
                <input type='number' id='attendanceBreakSingleMinutes' min='0' max='59' />
              </label>
              <label class='inline full'>
                <input type='checkbox' id='attendanceEnabled' checked />
                <span>启用该部门考核</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveAttendanceRule'>保存规则</button>
              <span class='form-status' id='attendanceStatus'></span>
            </div>
          </div>
          <div class='card'>
            <h3>状态阈值</h3>
            <div class='form-grid'>
              <label>
                <span>状态</span>
                <select id='attendanceStatusCode'></select>
              </label>
              <label>
                <span>最小阈值（小时）</span>
                <input type='number' id='attendanceMinHours' min='0' />
              </label>
              <label>
                <span>最小阈值（分钟）</span>
                <input type='number' id='attendanceMinMinutes' min='0' max='59' />
              </label>
              <label>
                <span>最大阈值（小时）</span>
                <input type='number' id='attendanceMaxHours' min='0' />
              </label>
              <label>
                <span>最大阈值（分钟）</span>
                <input type='number' id='attendanceMaxMinutes' min='0' max='59' />
              </label>
              <label>
                <span>触发处理</span>
                <select id='attendanceTriggerAction'>
                  <option value='show_only'>仅后台显示</option>
                  <option value='require_reason'>下班需要补录原因</option>
                </select>
              </label>
              <label class='inline full'>
                <input type='checkbox' id='attendanceThresholdEnabled' checked />
                <span>启用该阈值</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveAttendanceThreshold'>保存阈值</button>
              <button class='btn btn-secondary' id='resetAttendanceThreshold'>取消编辑</button>
              <span class='form-status' id='attendanceThresholdStatus'></span>
            </div>
            <div class='table' id='attendanceThresholdTable'></div>
          </div>
        </div>
        <div class='card'>
          <h3>当日不达标员工</h3>
          <div class='form-grid'>
            <label>
              <span>开始日期</span>
              <input type='date' id='reviewStartDate' />
            </label>
            <label>
              <span>结束日期</span>
              <input type='date' id='reviewEndDate' />
            </label>
            <label>
              <span>部门</span>
              <select id='reviewDepartment'></select>
            </label>
            <label>
              <span>员工</span>
              <div class="search-select" id="reviewEmployeeSelect">
                <input type="text" id="reviewEmployeeSearch" placeholder="搜索工号 / 姓名" autocomplete="off" />
                <input type="hidden" id="reviewEmployee" />
                <div class="search-select-panel" id="reviewEmployeePanel"></div>
              </div>
              <div class="field-hint" id="reviewEmployeeHint">可选，不填则查询全部</div>
            </label>
          </div>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadReviewList'>查询</button>
            <button class='btn btn-secondary' id='resetReviewList'>重置</button>
          </div>
          <div class='table' id='reviewTable'></div>
          <div class='pager' id='reviewPager'></div>
        </div>
      </section>
      <section class='section' id='section-audit'>
        <div class='section-header'>
          <div>
            <h2>异常与审计</h2>
            <p class='muted'>离线补录、系统事故、操作审计</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>离线补录</h3>
            <div class='form-grid'>
              <label>
                <span>员工</span>
                <div class="search-select" id="adjustEmployeeSelect">
  <input type="text" id="adjustEmployeeSearch" placeholder="搜索工号 / 姓名" autocomplete="off" />
  <input type="hidden" id="adjustEmployee" />
  <div class="search-select-panel" id="adjustEmployeePanel"></div>
</div>
<div class="field-hint" id="adjustEmployeeHint">请输入工号/姓名</div>
              </label>
              <label>
                <span>开始时间</span>
                <input type='datetime-local' id='adjustStart' />
              </label>
              <label>
                <span>结束时间</span>
                <input type='datetime-local' id='adjustEnd' />
              </label>
              <label>
                <span>原因</span>
                <select id='adjustReason'>
                  <option value='停电'>停电</option>
                  <option value='断网'>断网</option>
                  <option value='外勤'>外勤</option>
                  <option value='系统故障'>系统故障</option>
                </select>
              </label>
              <label class='full'>
                <span>备注（必填）</span>
                <input type='text' id='adjustNote' placeholder='请填写具体原因' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createAdjustment'>提交补录</button>
              <button class='btn btn-secondary' id='cancelAdjustment'>取消编辑</button>
              <span class='form-status' id='adjustStatus'></span>
            </div>
            <div class='table' id='adjustmentsTable'></div>
          </div>
          <div class='card'>
            <h3>系统事故登记</h3>
            <div class='form-grid'>
              <label>
                <span>开始时间</span>
                <input type='datetime-local' id='incidentStart' />
              </label>
              <label>
                <span>结束时间</span>
                <input type='datetime-local' id='incidentEnd' />
              </label>
              <label class='full'>
                <span>原因</span>
                <input type='text' id='incidentReason' placeholder='例如 数据库维护' />
              </label>
              <label class='full'>
                <span>备注</span>
                <input type='text' id='incidentNote' placeholder='可选' />
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='createIncident'>登记事故</button>
              <button class='btn btn-secondary' id='cancelIncident'>取消编辑</button>
              <span class='form-status' id='incidentStatus'></span>
            </div>
            <div class='table' id='incidentsTable'></div>
          </div>
        </div>
        <div class='card'>
          <h3>离线段列表</h3>
          <div class='form-grid'>
            <label>
              <span>日期</span>
              <input type='date' id='offlineDate' />
            </label>
            <label>
              <span>员工筛选</span>
              <div class="search-select" id="offlineEmployeeSelect">
  <input type="text" id="offlineEmployeeSearch" placeholder="搜索工号 / 姓名" autocomplete="off" />
  <input type="hidden" id="offlineEmployee" />
  <div class="search-select-panel" id="offlineEmployeePanel"></div>
</div>
<div class="field-hint" id="offlineEmployeeHint">可选，不填则查询全部</div>
            </label>
          </div>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadOfflineSegments'>刷新列表</button>
          </div>
          <div class='table' id='offlineSegmentsTable'></div>
        </div>
        <div class='card'>
          <h3>操作审计</h3>
          <div class='form-grid'>
            <label>
              <span>日期</span>
              <input type='date' id='auditDate' />
            </label>
          </div>
          <div class='form-actions'>
            <button class='btn btn-secondary' id='loadAudit'>加载审计</button>
          </div>
          <div class='table' id='auditTable'></div>
        </div>
      </section>

      <section class='section' id='section-org'>
        <div class='section-header'>
          <div>
            <h2>组织与员工</h2>
            <p class='muted'>部门与员工档案维护，避免手工输入</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>部门管理</h3>
            <div class='form-grid'>
              <label class='full'>
                <span>部门名称</span>
                <input type='text' id='deptName' placeholder='请输入部门名称' />
              </label>
              <label class='full'>
                <span>上级部门</span>
                <select id='deptParent'></select>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveDepartment'>保存部门</button>
              <button class='btn btn-secondary' id='cancelDepartment'>取消编辑</button>
              <span class='form-status' id='deptStatus'></span>
            </div>
            <div class='table' id='departmentsTable'></div>
          </div>
          <div class='card'>
            <h3>员工管理</h3>
            <div class='form-grid'>
              <label>
                <span>工号</span>
                <input type='text' id='employeeCode' placeholder='留空自动生成，例如 A0001' />
              </label>
              <label>
                <span>姓名</span>
                <input type='text' id='employeeName' placeholder='请输入姓名' />
              </label>
              <label>
                <span>部门</span>
                <select id='employeeDepartment'></select>
              </label>
              <label class='inline'>
                <input type='checkbox' id='employeeEnabled' checked />
                <span>启用员工</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveEmployee'>保存员工</button>
              <button class='btn btn-secondary' id='cancelEmployee'>取消编辑</button>
              <span class='form-status' id='employeeStatus'></span>
            </div>
            <div class='table' id='employeesTable'></div>
          </div>
        </div>
      </section>
      <section class='section' id='section-checkout'>
        <div class='section-header'>
          <div>
            <h2>下班录入模板</h2>
            <p class='muted'>按部门配置下班录入项，启用后下班必须填写</p>
          </div>
        </div>
        <div class='grid-2'>
          <div class='card'>
            <h3>模板配置</h3>
            <div class='form-grid'>
              <label class='full'>
                <span>部门</span>
                <select id='checkoutDepartment'></select>
              </label>
              <label class='full'>
                <span>模板名称</span>
                <input type='text' id='checkoutTemplateName' placeholder='例如 客服下班记录' />
              </label>
              <label class='inline'>
                <input type='checkbox' id='checkoutTemplateEnabled' />
                <span>启用模板（同部门仅允许一个启用）</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveCheckoutTemplate'>保存模板</button>
              <button class='btn btn-secondary' id='cancelCheckoutTemplate'>取消编辑</button>
              <span class='form-status' id='checkoutTemplateStatus'></span>
            </div>
            <div class='table' id='checkoutTemplatesTable'></div>
          </div>
          <div class='card'>
            <h3>字段配置</h3>
            <div class='form-grid'>
              <label class='full'>
                <span>字段名称</span>
                <input type='text' id='checkoutFieldName' placeholder='例如 客服账号' />
              </label>
              <label>
                <span>字段类型</span>
                <select id='checkoutFieldType'>
                  <option value='text'>文本</option>
                  <option value='number'>数字</option>
                  <option value='select'>下拉单选</option>
                </select>
              </label>
              <label>
                <span>排序</span>
                <input type='number' id='checkoutFieldSort' value='0' />
              </label>
              <label class='full'>
                <span>下拉选项（仅下拉，换行分隔）</span>
                <textarea id='checkoutFieldOptions' placeholder='选项1
选项2'></textarea>
              </label>
              <label class='inline'>
                <input type='checkbox' id='checkoutFieldRequired' />
                <span>必填</span>
              </label>
              <label class='inline'>
                <input type='checkbox' id='checkoutFieldEnabled' checked />
                <span>启用字段</span>
              </label>
            </div>
            <div class='form-actions'>
              <button class='btn btn-primary' id='saveCheckoutField'>保存字段</button>
              <button class='btn btn-secondary' id='cancelCheckoutField'>取消编辑</button>
              <span class='form-status' id='checkoutFieldStatus'></span>
            </div>
            <div class='table' id='checkoutFieldsTable'></div>
          </div>
        </div>
      
        <div class='card'>
          <h3>下班录入查询</h3>
          <div class='form-grid'>
            <label>
              <span>开始日期</span>
              <input type='date' id='checkoutQueryStart' />
            </label>
            <label>
              <span>结束日期</span>
              <input type='date' id='checkoutQueryEnd' />
            </label>
            <label>
              <span>部门</span>
              <select id='checkoutQueryDepartment'></select>
            </label>
            <label>
              <span>员工</span>
              <div class="search-select" id="checkoutEmployeeSelect">
  <input type="text" id="checkoutEmployeeSearch" placeholder="搜索工号 / 姓名" autocomplete="off" />
  <input type="hidden" id="checkoutEmployee" />
  <div class="search-select-panel" id="checkoutEmployeePanel"></div>
</div>
<div class="field-hint" id="checkoutEmployeeHint">正在加载员工...</div>
            </label>
            <label>
              <span>模板</span>
              <select id='checkoutQueryTemplate'></select>
            </label>
          </div>
          <div class='form-actions checkout-actions'>
            <div class='quick-range' id='checkoutQuickRange'>
              <button class='btn btn-secondary' data-range='today'>今天</button>
              <button class='btn btn-secondary' data-range='yesterday'>昨天</button>
              <button class='btn btn-secondary' data-range='week'>本周</button>
              <button class='btn btn-secondary' data-range='month'>本月</button>
            </div>
            <div class='checkout-actions-right'>
              <button class='btn btn-secondary' id='checkoutQuery'>查询</button>
              <button class='btn btn-secondary' id='checkoutReset'>重置</button>
            </div>
          </div>
          <div class='table' id='checkoutRecordsTable'></div>
          <div class='pager' id='checkoutRecordsPager'></div>
        </div>
</section>
    </main>
  </div>


  <div class='detail-modal' id='reviewDetailModal'>
    <div class='detail-card'>
      <div class='detail-header'>
        <div>
          <h3>不达标详情</h3>
          <p class='muted'>展示触发项与补录说明</p>
        </div>
        <button class='btn btn-secondary' id='closeReviewDetail'>关闭</button>
      </div>
      <div class='detail-body'>
        <div class='detail-meta' id='reviewDetailMeta'></div>
        <div class='detail-fields' id='reviewDetailFields'></div>
      </div>
    </div>
  </div>
  <div class='detail-modal' id='checkoutDetailModal'>
    <div class='detail-card'>
      <div class='detail-header'>
        <div>
          <h3>下班录入详情</h3>
          <p class='muted'>仅展示可读中文内容</p>
        </div>
        <button class='btn btn-secondary' id='closeCheckoutDetail'>关闭</button>
      </div>
      <div class='detail-body'>
        <div class='detail-meta' id='checkoutDetailMeta'></div>
        <div class='detail-fields' id='checkoutDetailFields'></div>
      </div>
    </div>
  </div>

  <script src='/assets/app.js'></script>
</body>
</html>



